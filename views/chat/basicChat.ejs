<h1>Welcome to the Chat</h1>

<%if(typeof user == 'object' && user){%>
    <%let firstName="scott"%>
    <!-- Display chat interface -->
    <form id="form" action="">
        <input id="input" autocomplete="off" /><button>Send</button>
    </form>
    <div id="chat">
        <!-- Chat messages will be displayed here -->
        <ul id="messages"></ul>
        <!-- Form for sending new messages -->
    </div>
<% } else { %>
    <p>Please log in to join the chat.</p>
<% } %>

<!-- Include Socket.IO library -->
<script src="/socket.io/socket.io.js"></script>
<script>
    // Establish a connection to the server
    var socket = io();

    // Function to add new messages to the chat interface
    function addMessage(sender, message) {
        var messages = document.getElementById('messages');
        var li = document.createElement('li');
        li.textContent = sender + ': ' + message; // Display sender's name
        messages.appendChild(li);
    }

    // Submit form event listener
    document.getElementById('form').addEventListener('submit', function(event) {
        event.preventDefault(); // Prevent form submission
        var input = document.getElementById('input');
        var message = input.value.trim(); // Get input value

        if (message !== ''&& typeof user =='object') {
            // Emit the message to the server
            socket.emit('chat message', message);
            // Add the message to the chat interface with sender's name
            addMessage(firstName, message); // Use user's first name as sender
            input.value = ''; // Clear input field
        }
    });

    // Receive new messages from the server
    socket.on('chat message', function(data) {
        addMessage(data.sender, data.message); // Display sender's name
    });
</script>
