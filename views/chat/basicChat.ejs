<div id="chat-window-basic">
    <h1>Room: Main Chat </h1>
    <%- include('../animations/confetti')%>
    <button id="chatToggle">chat</button>
    <% if(typeof user === 'object' && user) { %>
        <script>var firstName = "<%= user.firstName %>";</script>
        
          
            <div id="userList">
                <div class="loaderWheel">
                    <div class="loaderDiv">  <h3> loading chatroom...</h3></div>
                    <div class="loaderDiv"> <div class="wheel"></div></div>
                  
                   
                </div>
            <!--My Users Populate Here div class="userOnline"-->
            </div>
      <div class="inputBar">
            <input id="chatInput" autocomplete="off" /><button id="submitChat">Send</button>
        </div>
        <div id="chat">
        
            <div id="messages"> </div>
        </div>
        <%let userImg=user.userImg%>
    <% } else { %>
        <p>Please log in to join the chat.</p>
    <% } %>
</div>
<script src="/socket.io/socket.io.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', ()=>{

    var socket = io('/main_chat'); 

    // Function to add messages to the DOM
    function addMessage(messageObject) {
    var messagesContainer = document.getElementById('messages');
    
    // Create the message wrapper div
    var messageDiv = document.createElement('div');
    var messageAvatar =document.createElement('img');
    messageAvatar.className = 'message';
    messageAvatar.src = `/images/userHeadshots/${messageObject.user.userImg}`;
    messageDiv.className = 'message'; // Assign a class for styling

    // Optionally, create separate elements for the user name and message text
    var userNameSpan = document.createElement('span');
    userNameSpan.className = 'messageUser';
    userNameSpan.textContent = messageObject.user.firstName + ': '; // Assuming this structure

    var messageTextSpan = document.createElement('span');
    messageTextSpan.className = 'messageText';
    messageTextSpan.textContent = messageObject.text;

    // Append user name and message text to the message div
    messageDiv.appendChild(messageAvatar)
    messageDiv.appendChild(userNameSpan);
    messageDiv.appendChild(messageTextSpan);

    // Append the complete message div to the messages container
    messagesContainer.appendChild(messageDiv);
}


    // Add click event listener to the submit button
    var submitChat = document.getElementById('submitChat');
    if (submitChat) {
        submitChat.addEventListener('click', function(event) {
            var input = document.getElementById('chatInput');
            var message = input.value.trim();

            if (message !== '') {
                socket.emit('chat message', message); // Emit the message
                addMessage('You: ' + message); // Add message to the DOM
                input.value = ''; // Clear the input
            }
        });
    } else {
        console.log('Submit Chat button not found'); // Debugging: Check if button is found
    }

    // Listen for chat messages from the server
    socket.on('chat message', function(msg) {
        addMessage(msg); // Add incoming message to the DOM
    });
    socket.on('user list', function(users) {
    var userList = document.getElementById('userList');
    userList.innerHTML = ''; // Clear current list
    users.forEach(function(user) {
        var div = document.createElement('div');
        div.className = 'usersOnline';
        var img = document.createElement('img'); // Correct method to create an img element
        img.className = 'userImage'; // Assign a class for styling if needed
        img.alt = user.firstName; // Assuming `firstName` is the property
        img.src = `/images/userHeadshots/${user.userImg}`; 
        var text = document.createElement('span'); // Optional: add text next to the image
        text.textContent = user.firstName; // Show user's name next to the image
        
        div.appendChild(img);
        div.appendChild(text); // Optional
        userList.appendChild(div);   });
});

    // Error handling for Socket.IO
    socket.on('connect_error', (error) => {
        console.log('Connection Error:', error); // Log connection errors
    });
    socket.on('ping', (data) => {
                console.log(data.msg); // Logging the ping message from the server

                // Optionally, send a pong message back to the server
                socket.emit('pong', { msg: 'Pong from client' });
            });
      
    console.log('basic Chat!!')
})
document.addEventListener('DOMContentLoaded', ()=>{
    let chatWindowState = null;
const chatToggle = document.getElementById('chatToggle');
const chatBasicWindow = document.getElementById('chat-window-basic');
const main = document.getElementById('main')
chatToggle.addEventListener('click', ()=>{
    if(chatBasicWindow.style.transform!="translateX(-106%)"){
        chatBasicWindow.style.transform="translateX(-106%)";
  
   chatToggle.innerHTML="close";  
   chatWindowState="open"   
}else{
   
    chatBasicWindow.style.transform="translateX(0%)";
    chatToggle.innerHTML="chat";  
    chatWindowState="hidden"   ;
}
})
})




</script>